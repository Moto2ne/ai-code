name: æ¯æ—¥ã®AIãƒ‹ãƒ¥ãƒ¼ã‚¹åé›†ï¼†æˆ¦è¡“ç”Ÿæˆ

on:
  schedule:
    - cron: '0 21 * * *'  # æ—¥æœ¬æ™‚é–“ 06:00 (UTC 21:00)
  workflow_dispatch:  # æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½

permissions:
  contents: write  # ãƒªãƒã‚¸ãƒˆãƒªã¸ã®æ›¸ãè¾¼ã¿æ¨©é™

jobs:
  daily_intel:
    runs-on: ubuntu-latest
    
    steps:
      - name: ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Pythonç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        run: |
          pip install --upgrade pip
          pip install google-genai python-dotenv requests
      
      - name: ãƒ‹ãƒ¥ãƒ¼ã‚¹åé›†ã‚’å®Ÿè¡Œ
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: |
          echo "ğŸ“° ãƒ‹ãƒ¥ãƒ¼ã‚¹åé›†ã‚’é–‹å§‹..."
          python scripts/collector.py
      
      - name: æˆ¦è¡“åˆ†æã‚’å®Ÿè¡Œ
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: |
          echo "ğŸ¯ æˆ¦è¡“åˆ†æã‚’é–‹å§‹..."
          python scripts/analyst.py
      
      - name: ãƒ‡ãƒ¼ã‚¿ã‚’ãƒãƒ¼ã‚¸ã—ã¦ã‚³ãƒŸãƒƒãƒˆ
        run: |
          echo "ğŸ”€ æˆ¦è¡“ã‚’ãƒãƒ¼ã‚¸..."
          python scripts/merge_tactics.py
          
          git config user.name "AI Staff Officer"
          git config user.email "ai-staff@tactical-intel.ai"
          
          # AIæˆ¦è¡“ãƒ•ã‚¡ã‚¤ãƒ«ã®å¤‰æ›´ã‚’ãƒã‚§ãƒƒã‚¯
          if git diff --quiet data/ai_tactics.json; then
            echo "ğŸ“­ æ–°ã—ã„AIæˆ¦è¡“ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸ"
          else
            git add data/ai_tactics.json
            git commit -m "è‡ªå‹•æ›´æ–°: $(date +%Y-%m-%d) ã®AIæˆ¦è¡“ã‚’è¿½åŠ "
            git push
            echo "âœ… æ–°ã—ã„AIæˆ¦è¡“ã‚’ã‚³ãƒŸãƒƒãƒˆã—ã¾ã—ãŸ"
          fi
