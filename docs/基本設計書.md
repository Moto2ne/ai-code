# AI司令塔ナレッジ - 基本設計書 (v4.0)

## 1. これは何？

**毎朝6時に最新AIニュースを自動収集 → 実務で使えるプロンプトに変換**

寝ている間に最新AI情報が勝手に追加される「生きたプロンプト集」です。

---

## 2. 使い方（3ステップ）

### ステップ1: アプリを開く
https://your-app.streamlit.app/ にアクセス

### ステップ2: 検索・絞り込み
- キーワード検索（例: `Claude`, `コード生成`）
- タグで絞り込み

### ステップ3: プロンプトをコピー
「✨ プロンプト発行」ボタン → そのままAIにペースト！

---

## 3. システム構成

```
ai-code/
├── app.py                  # Webアプリ（Streamlit）
├── styles.py               # デザイン
├── data/
│   └── ai_tactics.json     # 戦術データ（毎日自動更新）
├── scripts/
│   ├── collector.py        # ニュース収集（Gemini API）
│   ├── analyst.py          # 戦術生成（Gemini API）
│   └── merge_tactics.py    # データマージ
├── .github/workflows/
│   └── daily_intel.yml     # 毎朝6時に自動実行
└── requirements.txt
```

---

## 4. 自動更新の流れ

```
毎朝6時（GitHub Actions）
    │
    ▼
┌─────────────────┐
│  collector.py   │  ← Gemini API + Google検索で最新ニュース5件取得
└────────┬────────┘
         │
         ▼
   [news_raw.json]
         │
         ▼
┌─────────────────┐
│   analyst.py    │  ← ニュースを「実務で使えるプロンプト」に変換
└────────┬────────┘
         │
         ▼
  [new_tactics.json]
         │
         ▼
┌─────────────────┐
│ merge_tactics.py│  ← 既存データにマージ（重複防止）
└────────┬────────┘
         │
         ▼
[data/ai_tactics.json]  ← Streamlitアプリが読み込む
```

---

## 5. データ形式

### ai_tactics.json

```json
{
  "id": "20251208_150418_01",
  "date": "2025-12-08",
  "title": "Claude 4.5でコードレビュー自動化",
  "problem_context": "PRのレビュー待ち時間が長い",
  "tags": ["コードレビュー", "Claude", "自動化"],
  "recommended_ai": {
    "model": "Claude 4.5 Opus",
    "reason": "長文コード理解とセキュリティ分析に最適"
  },
  "prompt": "以下のPRの差分をレビューしてください...",
  "source_news": {
    "title": "Anthropic Claude 4.5リリース",
    "url": "https://anthropic.com/..."
  }
}
```

### 項目説明

| 項目 | 説明 |
|------|------|
| `id` | タイムスタンプID（`YYYYMMDD_HHMMSS_NN`） |
| `date` | 作成日 |
| `title` | 戦術タイトル（30文字以内） |
| `problem_context` | どんな課題を解決するか |
| `tags` | 検索用タグ |
| `recommended_ai` | 推奨AIモデルと理由 |
| `prompt` | そのまま使えるプロンプト |
| `source_news` | 元ニュースのタイトルとURL |

---

## 6. 使用技術

| 用途 | 技術 |
|------|------|
| Webアプリ | Streamlit + Streamlit Cloud |
| ニュース収集 | Gemini 2.5 Flash Lite + Google Search Grounding |
| 戦術生成 | Gemini 2.5 Flash |
| 自動実行 | GitHub Actions（毎朝6時JST） |
| データ | JSON（最大500件） |

---

## 7. GitHub Actions設定

### daily_intel.yml

```yaml
name: 毎日のAIニュース収集

on:
  schedule:
    - cron: '0 21 * * *'  # JST 06:00
  workflow_dispatch:      # 手動実行

permissions:
  contents: write

jobs:
  daily_intel:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - run: pip install google-genai python-dotenv requests
      
      - name: ニュース収集
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: python scripts/collector.py
      
      - name: 戦術生成
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: python scripts/analyst.py
      
      - name: マージ＆コミット
        run: |
          python scripts/merge_tactics.py
          git config user.name "AI Staff Officer"
          git config user.email "ai@example.com"
          git diff --quiet data/ai_tactics.json || \
            (git add data/ai_tactics.json && \
             git commit -m "🤖 $(date +%Y-%m-%d) AI戦術追加" && \
             git push)
```

### 必要なSecret

| 名前 | 説明 |
|------|------|
| `GEMINI_API_KEY` | Google AI Studioで取得 |

---

## 8. ローカル開発

```bash
# クローン
git clone https://github.com/Moto2ne/ai-code.git
cd ai-code

# 環境構築
python -m venv venv
venv\Scripts\activate  # Windows
pip install -r requirements.txt

# .envファイル作成
echo "GEMINI_API_KEY=your_key_here" > .env

# 手動でニュース収集＆戦術生成
python scripts/collector.py
python scripts/analyst.py
python scripts/merge_tactics.py

# アプリ起動
streamlit run app.py
```

---

## 9. よくある質問

### Q: 新しい戦術が追加されない
**A:** GitHub Actions のログを確認
- Actions タブ → 最新のワークフロー → ログ確認
- `GEMINI_API_KEY` が設定されているか確認

### Q: 手動で今すぐ更新したい
**A:** 2つの方法
1. **GitHub上**: Actions → Run workflow
2. **ローカル**: `collector.py` → `analyst.py` → `merge_tactics.py` → push

### Q: 古い戦術を削除したい
**A:** `data/ai_tactics.json` を直接編集してpush

### Q: Streamlitに反映されない
**A:** キャッシュが原因。5分待つか、Streamlit Cloud でReboot app

---

## 10. 制限事項

| 項目 | 制限 |
|------|------|
| 1日の新規追加 | 最大5件 |
| 総データ数 | 最大500件（古いものは自動削除） |
| キャッシュ | 5分ごとに更新 |

---

## 改訂履歴

| 版 | 日付 | 内容 |
|----|------|------|
| 4.0 | 2025/12/08 | 経験則を廃止、最新AI情報特化にシンプル化 |
| 3.0 | 2025/12/08 | データ分離、タイムスタンプID |
| 2.0 | 2025/12/08 | 自動更新機能追加 |
| 1.0 | 2025/12/08 | 初版 |
